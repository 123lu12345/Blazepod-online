<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8"/>
  <title>
   BlazePod Dashboard
  </title>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <style>
   body { font-family: sans-serif; background: #121212; color: white; text-align: center; padding: 2rem; }
        .pod { padding: 1rem; margin: 0.5rem; border-radius: 1rem; display: none; background: #444; min-width: 100px; }
        .connected { background: green !important; }
        #startBtn, #stopBtn, #restartBtn {
            margin-top: 1rem; padding: 1rem 2rem; font-size: 1.2rem;
            border: none; border-radius: 1rem; color: white; cursor: pointer;
        }
        #startBtn { background: dodgerblue; display: none; }
        #stopBtn { background: crimson; display: none; }
        #restartBtn { background: green; display: none; }
        .settings label, .settings input, .settings select { margin: 0.5rem; font-size: 1.1rem; }
        .settings input { width: 60px; text-align: center; }
        .qr-code { margin: 1rem; display: none; }
        .qr-code canvas { border: 4px solid white; border-radius: 1rem; }
        #countdown, #timer, #statusMessage { font-size: 1.5rem; margin-top: 2rem; }
  
    #colorSelection {
      display: flex;
      flex-wrap: nowrap;
      justify-content: center;
      gap: 0.75rem;
      flex-direction: row;
      overflow-x: auto;
    }
    #colorSelection input[type="checkbox"] {
      transform: scale(0.6);
      margin: 0;
    }
    #colorSelection label {
      display: inline-block;
      font-size: 0.9rem;
      margin-right: 0.3rem;
    }
  
    #colorSelection {
      display: flex;
      flex-wrap: nowrap;
      justify-content: center;
      gap: 0.2rem;
      overflow-x: auto;
      white-space: nowrap;
    }
    #colorSelection input[type="checkbox"] {
      transform: scale(0.6);
      margin: 0;
    }
    #colorSelection label {
      font-size: 0.8rem;
      margin: 0;
      padding-right: 0.2rem;
    }
  </style>
  <style>
   body {
    font-family: 'Segoe UI', sans-serif;
    background-color: #111;
    color: #fff;
    text-align: center;
    margin: 0;
    padding: 2rem;
  }
  h1 {
    margin-bottom: 2rem;
    font-size: 2.5rem;
    color: #00d8ff;
  }
  select, input[type="number"], input[type="checkbox"], label {
    font-size: 1.1rem;
    margin: 0.25rem;
  }
  .pod-status {
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin-bottom: 1rem;
  }
  .pod-status button {
    background-color: #333;
    color: #fff;
    padding: 1rem 2rem;
    border: none;
    border-radius: 1rem;
    font-weight: bold;
  }
  .pod-status .connected {
    background-color: #0f0;
  }
  .settings {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 1rem;
    margin: 1.5rem 0;
  }
  #colorSelection {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    margin-top: 1rem;
    gap: 0.8rem;
  }
  .controls {
    margin: 2rem 0;
  }
  button {
    font-size: 1.2rem;
    padding: 0.6rem 1.5rem;
    border: none;
    border-radius: 0.8rem;
    margin: 0.5rem;
    cursor: pointer;
  }
  #startBtn {
    background-color: #007bff;
    color: #fff;
  }
  #stopBtn {
    background-color: #dc3545;
    color: #fff;
  }
  #qrCodes img {
    width: 180px;
    margin: 1rem;
    border-radius: 0.5rem;
    background: #fff;
    padding: 0.5rem;
  }
  </style>
 </head>
 <body>
  <h1>
   BlazePod Dashboard
  </h1>
  <div id="pods">
   <div class="pod" id="pod1">
    Pod 1
   </div>
   <div class="pod" id="pod2">
    Pod 2
   </div>
   <div class="pod" id="pod3">
    Pod 3
   </div>
   <div class="pod" id="pod4">
    Pod 4
   </div>
  </div>
  <div class="settings">
   <label>
    Spielzeit (min):
   </label>
   <input id="gameDuration" max="15" min="1" type="number" value="1"/>
   <label>
    Blink-Intervall (sek):
   </label>
   <input id="blinkInterval" max="10" min="1" type="number" value="1"/>
   <label>
    Pause zwischen Blinks (sek):
   </label>
   <input id="blackPause" max="10" min="0" step="0.1" type="number" value="1"/>
   <br/>
   <label>
    Ben√∂tigte Pods:
   </label>
   <select id="requiredPods" onchange="updatePodVisibility()">
    <option value="1">
     1 Pod
    </option>
    <option value="2">
     2 Pods
    </option>
    <option value="3">
     3 Pods
    </option>
    <option selected="" value="4">
     4 Pods
    </option>
   </select>
   <br/>
   <label>
    <input id="randomTimingToggle" onchange="toggleIntervalFields()" type="checkbox"/>
    Zufallsmodus aktivieren
   </label>
   <br/>
   <label>
    Spielmodus:
   </label>
   <select id="gameMode" onchange="toggleIntervalFields(); toggleTargetColor()">
    <option value="classic">
     Classic
    </option>
    <option value="shapes">
     Formen
    </option>
    <option value="numbers">
     Zahlen
    </option>
    <option value="touch-switch">
     Touch to Switch
    </option>
    <option value="stroop">
     Stroop-Test
    </option>
   </select>
   
   <div id="targetColorContainer" style="display:none; margin-top: 1rem;">
     <label for="targetColor">Zielfarbe:</label>
     <select id="targetColor"></select>
   </div>

<div id="colorSelection" style="margin-top: 1em;">
    <input checked="checked" data-color="red" id="color_red" type="checkbox"/>
    <label for="color_red">
     Rot
    </label>
    <input checked="checked" data-color="blue" id="color_blue" type="checkbox"/>
    <label for="color_blue">
     Blau
    </label>
    <input checked="checked" data-color="green" id="color_green" type="checkbox"/>
    <label for="color_green">
     Gr√ºn
    </label>
    <input checked="checked" data-color="yellow" id="color_yellow" type="checkbox"/>
    <label for="color_yellow">
     Gelb
    </label>
    <input checked="checked" data-color="pink" id="color_pink" type="checkbox"/>
    <label for="color_pink">
     Pink
    </label>
    <input checked="checked" data-color="orange" id="color_orange" type="checkbox"/>
    <label for="color_orange">
     Orange
    </label>
    <input checked="checked" data-color="white" id="color_white" type="checkbox"/>
    <label for="color_white">
     Wei√ü
    </label>
    <input checked="checked" data-color="black" id="color_black" type="checkbox"/>
    <label for="color_black">
     Schwarz
    </label>
    <input checked="checked" data-color="violet" id="color_violet" type="checkbox"/>
    <label for="color_violet">
     Violett
    </label>
   </div>
  </div>
  <br/>
  <button id="startBtn">
   Start
  </button>
  <button id="stopBtn">
   Stopp
  </button>
  <button id="restartBtn" onclick="location.reload()">
   Neustart
  </button>
  <div id="countdown">
  </div>
  <div id="timer">
  </div>
  <div id="scoreDisplay" style="font-size: 1.8rem; margin-top: 2rem;"></div>
  <div id="statusMessage">
  </div>
  <h2>
   QR-Codes f√ºr Pods
  </h2>
  <div class="qr-code" id="qr1">
  </div>
  <div class="qr-code" id="qr2">
  </div>
  <div class="qr-code" id="qr3">
  </div>
  <div class="qr-code" id="qr4">
  </div>
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js">
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js">
  </script>
  <script>
   const socket = io();
    const podElements = {
        "1": document.getElementById("pod1"),
        "2": document.getElementById("pod2"),
        "3": document.getElementById("pod3"),
        "4": document.getElementById("pod4")
    };

    let gameDurationSeconds = 0;
    let timerInterval = null;
    let startTimerAfterCountdown = false;

    
    function toggleTargetColor() {
        const mode = document.getElementById("gameMode").value;
        document.getElementById("targetColorContainer").style.display = (mode === "reaktionsspiel") ? "block" : "none";
        updateTargetColorOptions();
    }

    function updateTargetColorOptions() {
        const colorCheckboxes = document.querySelectorAll('#colorSelection input[type="checkbox"]');
        const targetColorSelect = document.getElementById("targetColor");
        targetColorSelect.innerHTML = "";
        colorCheckboxes.forEach(cb => {
            if (cb.checked) {
                const color = cb.getAttribute("data-color");
                const option = document.createElement("option");
                option.value = color;
                option.innerText = color.charAt(0).toUpperCase() + color.slice(1);
                targetColorSelect.appendChild(option);
            }
        });
    }

    document.querySelectorAll('#colorSelection input[type="checkbox"]').forEach(cb => {
        cb.addEventListener('change', updateTargetColorOptions);
    });

    function updatePodVisibility() {
        const required = parseInt(document.getElementById("requiredPods").value);
        for (let i = 1; i <= 4; i++) {
            document.getElementById("pod" + i).style.display = (i <= required) ? "inline-block" : "none";
            document.getElementById("qr" + i).style.display = (i <= required) ? "inline-block" : "none";
        }
    }

    function updateStartButtons(connected) {
        const required = parseInt(document.getElementById("requiredPods").value);
        const activePods = connected.length;
        const showButtons = activePods >= required;
        document.getElementById("startBtn").style.display = showButtons ? "inline-block" : "none";
        document.getElementById("stopBtn").style.display = showButtons ? "inline-block" : "none";
    }

    function toggleIntervalFields() {
        const isRandom = document.getElementById("randomTimingToggle").checked;
        document.getElementById("blinkInterval").style.display = isRandom ? "none" : "inline-block";
        document.getElementById("blackPause").style.display = isRandom ? "none" : "inline-block";
    }

    function updateTimerDisplay() {
        const minutes = Math.floor(gameDurationSeconds / 60);
        const seconds = gameDurationSeconds % 60;
        document.getElementById("timer").innerText = `Verbleibende Spielzeit: ${minutes}:${seconds.toString().padStart(2, '0')}`;
    }

    socket.on("update", connected => {
        Object.keys(podElements).forEach(id => {
            podElements[id].classList.remove("connected");
            if (connected.includes(id)) {
                podElements[id].classList.add("connected");
            }
        });
        updateStartButtons(connected);
    });

    document.getElementById("startBtn").onclick = () => {
        const duration = parseInt(document.getElementById("gameDuration").value);
        const interval = parseFloat(document.getElementById("blinkInterval").value);
        const pause = parseFloat(document.getElementById("blackPause").value);
        const mode = document.getElementById("gameMode").value;
        const randomTiming = document.getElementById("randomTimingToggle").checked;
        const targetColor = document.getElementById("targetColor").value;
        socket.emit("start_game", { duration, interval, pause, multicolor: false, randomTiming, mode, targetColor });
        gameDurationSeconds = duration * 60;
        updateTimerDisplay();
        startTimerAfterCountdown = true;
    };

    socket.on("countdown_tick", data => {
        document.getElementById("countdown").innerText = data.value > 0 ? `Start in ${data.value}...` : "";
        if (data.value === 0 && startTimerAfterCountdown) {
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                if (gameDurationSeconds > 0) {
                    gameDurationSeconds--;
                    updateTimerDisplay();
                }
            }, 1000);
            startTimerAfterCountdown = false;
        }
    });

    document.getElementById("stopBtn").onclick = () => {
        socket.emit("stop_game");
        clearInterval(timerInterval);
        document.getElementById("timer").innerText = "";
    };

    socket.on("game_finished", () => {
        document.getElementById("statusMessage").innerText = "‚úÖ Spiel beendet";
        clearInterval(timerInterval);
    });

    socket.on("game_stopped", () => {
        document.getElementById("statusMessage").innerText = "‚ùå Spiel abgebrochen";
        clearInterval(timerInterval);
    });

    
    socket.on("score_update", data => {
        document.getElementById("scoreDisplay").innerText = "üèÜ Punkte: " + data.score;
    });

    socket.on("game_stopped", () => {
        if (!document.getElementById("scoreDisplay").innerText) {
            document.getElementById("scoreDisplay").innerText = "üèÅ Spiel abgebrochen.";
        }
    });

    socket.on("game_finished", () => {
        if (!document.getElementById("scoreDisplay").innerText) {
            document.getElementById("scoreDisplay").innerText = "‚úÖ Spiel beendet.";
        }
    });

    const baseURL = window.location.origin;
    for (let i = 1; i <= 4; i++) {
        const qr = new QRious({
            element: document.getElementById("qr" + i).appendChild(document.createElement("canvas")),
            value: `${baseURL}/pod/${i}`,
            size: 150
        });
    }

    updatePodVisibility();
  </script>
 </body>
</html>
