<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>BlazePod Dashboard</title>
  <script src="https://cdn.socket.io/4.3.2/socket.io.min.js"></script>
  <style>
    body { background: #111; color: white; font-family: sans-serif; margin: 0; padding: 1rem; }
    .tab { display: none; }
    .tab.active { display: block; }
    .tabs button { margin-right: 0.5rem; }
    .status { display: flex; gap: 10px; margin: 1rem 0; }
    .status div { width: 20px; height: 20px; border-radius: 4px; background: grey; }
    .status .connected { background: green; }
  </style>
</head>
<body>

<h1>BlazePod Dashboard</h1>
<div class="tabs">
  <button onclick="showTab('spiel')">▶ Spiel</button>
  <button onclick="showTab('einstellungen')">⚙ Einstellungen</button>
</div>

<div id="spiel" class="tab active">
  <p>Countdown: <span id="startCountdown">-</span></p>
  <button id="startBtn">Start</button>
  <button id="stopBtn" style="display:none;">Stopp</button>
</div>

<div id="einstellungen" class="tab">
  <label>Modus:
    <select id="gameMode">
      <option value="classic">Classic</option>
      <option value="formen">Formen</option>
      <option value="zahlen">Zahlen</option>
      <option value="touch">Touch-to-Switch</option>
      <option value="reaktion">Reaktionsspiel</option>
      <option value="stoop">Stoop-Test</option>
    </select>
  </label>
  <br><br>
  Dauer (Minuten): <input id="duration" type="number" value="1" min="1" /><br>
  Blinkintervall (Sek): <input id="interval" type="number" step="0.1" value="2" /><br>
  Pause zwischen Blinks (Sek): <input id="pause" type="number" step="0.1" value="1" /><br>
  Ziel-Farbe (für Reaktionsspiel): 
  <select id="targetColor">
    <option value="red">Rot</option>
    <option value="blue">Blau</option>
    <option value="green">Grün</option>
    <option value="yellow">Gelb</option>
  </select>
</div>

<div class="status">
  <div id="pod1"></div>
  <div id="pod2"></div>
  <div id="pod3"></div>
  <div id="pod4"></div>
</div>

<script>
  const socket = io();
  const startCountdown = document.getElementById("startCountdown");
  const startBtn = document.getElementById("startBtn");
  const stopBtn = document.getElementById("stopBtn");

  startBtn.onclick = () => {
    const mode = document.getElementById("gameMode").value;
    const duration = parseInt(document.getElementById("duration").value) * 60;
    const interval = parseFloat(document.getElementById("interval").value);
    const pause = parseFloat(document.getElementById("pause").value);
    const targetColor = document.getElementById("targetColor").value;
    socket.emit("start", { mode, duration, interval, pause, target_color: targetColor });
    startBtn.style.display = "none";
    stopBtn.style.display = "inline-block";
  };

  stopBtn.onclick = () => {
    socket.emit("stop");
    startBtn.style.display = "inline-block";
    stopBtn.style.display = "none";
  };

  socket.on("countdown_tick", data => {
    startCountdown.textContent = data.value;
  });

  function showTab(tabId) {
    document.querySelectorAll(".tab").forEach(tab => tab.classList.remove("active"));
    document.getElementById(tabId).classList.add("active");
  }

  socket.on("pod_connected", podId => {
    const el = document.getElementById("pod" + podId);
    if (el) el.classList.add("connected");
  });

  socket.on("pod_disconnected", podId => {
    const el = document.getElementById("pod" + podId);
    if (el) el.classList.remove("connected");
  });
</script>
</body>
</html>